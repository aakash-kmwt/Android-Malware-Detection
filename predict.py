# -*- coding: utf-8 -*-
"""
Created on Tue Jun  2 20:06:11 2020

@author: mss2015
"""

import pickle
import sys
import numpy as np
from pymongo import MongoClient, DESCENDING
from constants import DB_NAME, ALG_TYPES
from core import extract_features, create_vector_single

if __name__ == '__main__':
    if len(sys.argv) > 1:
        file_path = sys.argv[1]
        features = extract_features(file_path)
        feature_vector = create_vector_single(features)
        feature_vector_new=np.reshape(feature_vector, (-1,322))
        client = MongoClient()
        db = client[DB_NAME]
        entry = db.train.find().sort([('timestamp', -1)])[0]
        train_data = entry['train_data']
        clf = pickle.loads(train_data)
        result = clf.predict(feature_vector_new)
        if result == 1:
            print ('This application is MALWARE')
        else:
            print ('This application is GOODWARE')
    else:
        print ('[+] Usage: python {} <file_path>'.format(__file__))